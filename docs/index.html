<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interface to TensorFlow SIG Addons  • tfaddons</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Interface to TensorFlow SIG Addons ">
<meta property="og:description" content="TensorFlow SIG Addons &lt;https://www.tensorflow.org/addons&gt; is a repository 
             of community contributions that conform to well-established API patterns, 
             but implement new functionality not available in core TensorFlow. 
             TensorFlow natively supports a large number of operators, layers, metrics, 
             losses, optimizers, and more. However, in a fast moving field like Machine Learning, 
             there are many interesting new developments that cannot be integrated into 
             core TensorFlow (because their broad applicability is not yet clear, or 
             it is mostly used by a smaller subset of the community).">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">tfaddons</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.10.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/NMT.html">Neural Machine Translation</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/henry090/tfaddons/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<div id="r-interface-to-useful-extra-functionality-for-tensorflow-2-x-by-sig-addons" class="section level2">
<h2 class="hasAnchor">
<a href="#r-interface-to-useful-extra-functionality-for-tensorflow-2-x-by-sig-addons" class="anchor"></a>R interface to useful extra functionality for TensorFlow 2.x by SIG-addons</h2>
<p>The <code>tfaddons</code> package provides R wrappers to <a href="https://www.tensorflow.org/addons">TensorFlow Addons</a>.</p>
<p><strong>TensorFlow Addons</strong> is a repository of contributions that conform to well-established API patterns, but implement new functionality not available in core TensorFlow. TensorFlow natively supports a large number of operators, layers, metrics, losses, and optimizers. However, in a fast moving field like ML, there are many interesting new developments that cannot be integrated into core TensorFlow (because their broad applicability is not yet clear, or it is mostly used by a smaller subset of the community).</p>
<p><a href="https://github.com/henry090/tfaddons"><img src="https://github.com/henry090/tfaddons/workflows/tfaddons/badge.svg" alt="Actions Status"></a> <a href="https://cran.r-project.org/package=tfaddons"><img src="https://www.r-pkg.org/badges/version/tfaddons?color=darkgreen" alt="CRAN"></a> <a href="https://www.tidyverse.org/lifecycle/#experimental"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a> <a href="https://github.com/henry090/tfaddons/commits/master"><img src="https://img.shields.io/github/last-commit/henry090/tfaddons.svg" alt="Last commit"></a></p>
<p><img src="images/tfaddons.png" width="200" align="right" style="margin-left: 15px;" alt="TF-addons"></p>
<p>Addons provide the following features which are compatible with <code>keras</code> library.</p>
<ul>
<li>activations</li>
<li>callbacks</li>
<li>image</li>
<li>layers</li>
<li>losses</li>
<li>metrics</li>
<li>optimizers</li>
<li>rnn</li>
<li>seq2seq</li>
<li>text</li>
</ul>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>Requirements:</p>
<ul>
<li>TensorFlow 2.X</li>
</ul>
<p>The dev version:</p>
<pre><code><a href="https://devtools.r-lib.org//reference/remote-reexports.html">devtools::install_github('henry090/tfaddons')</a></code></pre>
<p>Later, you need to install the python module <em>tensorflow-addons</em>:</p>
<pre><code><a href="reference/install_tfaddons.html">tfaddons::install_tfaddons()</a></code></pre>
</div>
<div id="usage-the-basics" class="section level2">
<h2 class="hasAnchor">
<a href="#usage-the-basics" class="anchor"></a>Usage: the basics</h2>
<p>Here’s how to build a sequential model with <code>keras</code> using additional features from <code>tfaddons</code> package.</p>
<p>Import and prepare MNIST dataset.</p>
<pre><code><a href="https://rdrr.io/pkg/keras/man">library(keras)
library(tfaddons)

mnist = dataset_mnist()

x_train &lt;- mnist$train$x
y_train &lt;- mnist$train$y

# reshape the dataset
x_train &lt;- array_reshape(x_train, c(nrow(x_train), 28, 28, 1))

# Transform RGB values into [0,1] range
x_train &lt;- x_train / 255

y_train &lt;- to_categorical(y_train, 10)</a></code></pre>
<p>Using the Sequential API, define the model architecture.</p>
<pre><code># Build a sequential model
model = keras_model_sequential() %&gt;% 
  layer_conv_2d(filters = 10, kernel_size = c(3,3),input_shape = c(28,28,1),
                #apply activation gelu
                activation = activation_gelu) %&gt;% 
  # apply group normalization layer
  layer_group_normalization(groups = 5, axis = 3) %&gt;% 
  layer_flatten() %&gt;% 
  layer_dense(10, activation='softmax')

# Compile
model %&gt;% compile(
  # apply rectified adam
  optimizer = optimizer_radam(),
  # apply sparse max loss
  loss = loss_sparsemax(),
  # choose cohen kappa metric
  metrics = metric_cohen_kappa(10)
)</code></pre>
<p>Train the Keras model.</p>
<pre><code>model %&gt;% fit(
  x_train, y_train,
  batch_size = 128,
  epochs = 1,
  validation_split = 0.2
)</code></pre>
<pre><code>Train on 48000 samples, validate on 12000 samples
48000/48000 [==============================] - 24s 510us/sample - loss: 0.1193 - cohen_kappa: 0.8074 - 
val_loss: 0.0583 - val_cohen_kappa: 0.9104</code></pre>
<p>Let’s apply <code>Weight Normalization</code>, a Simple Reparameterization technique to Accelerate Training of Deep Neural Networks:</p>
<blockquote>
<p>Note: We only change the model architecture and then train our model.</p>
</blockquote>
<pre><code># Build a sequential model
model = keras_model_sequential() %&gt;% 
  layer_weight_normalization(input_shape = c(28L,28L,1L),
                             layer_conv_2d(filters = 10, kernel_size = c(3,3))) %&gt;% 
  layer_flatten() %&gt;% 
  layer_weight_normalization(layer_dense(units = 10, activation='softmax'))</code></pre>
<pre><code>Train on 48000 samples, validate on 12000 samples
48000/48000 [==============================] - 12s 253us/sample - loss: 0.1276 - cohen_kappa: 0.7920 - 
val_loss: 0.0646 - val_cohen_kappa: 0.9044</code></pre>
<p>We can see that the training process has finished in <em>12 seconds</em>. But without this method, 1 epoch required <em>24 seconds</em>.</p>
</div>
<div id="callbacks" class="section level2">
<h2 class="hasAnchor">
<a href="#callbacks" class="anchor"></a>Callbacks</h2>
<p>One can stop training after certain time. For this purpose, <code>seconds</code> parameter should be set in <code>callback_time_stopping</code> function:</p>
<pre><code>model %&gt;% fit(
  x_train, y_train,
  batch_size = 128,
  epochs = 4,
  validation_split = 0.2,
  verbose = 0,
  callbacks = callback_time_stopping(seconds = 6, verbose = 1)
)</code></pre>
<pre><code>Timed stopping at epoch 1 after training for 0:00:06</code></pre>
</div>
<div id="losses" class="section level2">
<h2 class="hasAnchor">
<a href="#losses" class="anchor"></a>Losses</h2>
<p><code>TripletLoss</code> can be applied in the following form:</p>
<p>First task is to create a Keras model.</p>
<pre><code>model = keras_model_sequential() %&gt;% 
  layer_conv_2d(filters = 64, kernel_size = 2, padding='same', input_shape=c(28,28,1)) %&gt;% 
  layer_max_pooling_2d(pool_size=2) %&gt;% 
  layer_flatten() %&gt;% 
  layer_dense(256, activation= NULL) %&gt;% 
  layer_lambda(f = function(x) tf$math$l2_normalize(x, axis = 1L))

model %&gt;% compile(
  optimizer = optimizer_lazy_adam(),
  # apply triplet semihard loss
  loss = loss_triplet_semihard())</code></pre>
<p>With <code>tfdatasets</code> package we can <em>cast</em> our dataset and then <code>fit</code>.</p>
<pre><code><a href="https://rdrr.io/pkg/tfdatasets/man">library(tfdatasets)

train = tensor_slices_dataset(list(tf$cast(x_train,'uint8'),tf$cast( y_train,'int64'))) %&gt;% 
  dataset_shuffle(1024) %&gt;% dataset_batch(32)
  
# fit
model %&gt;% fit(
  train,
  epochs = 1
)</a></code></pre>
<pre><code>Train for 1875 steps
1875/1875 [==============================] - 74s 39ms/step - loss: 0.4227</code></pre>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/henry090/tfaddons/">https://​github.com/​henry090/​tfaddons/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/henry090/tfaddons/issues">https://​github.com/​henry090/​tfaddons/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>Apache License 2.0</li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Turgut Abdullayev <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by Turgut Abdullayev.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
